<!DOCTYPE html>
<html>

<head>

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: rgb(85, 40, 249);
    }

    h1 {
      text-align: center;
    }

    #login,
    #reservation {
      width: 400px;
      margin: 50px auto;
      padding: 30px;
      background-color: white;
      border-radius: 10px;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      width: 100%;
      background-color: #4CAF50;
      padding: 10px;
      border: none;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }

    
    #my-reservations div {
      margin-bottom: 20px;
    }

    #reservation-message {
      margin-top: 20px;
      padding: 10px;
      border-radius: 5px;
      display: none;
    }

    .success {
      background-color: #4CAF50;
      color: white;
    }

    .error {
      background-color: #f44336;
      color: white;
    }
  </style>

</head>

<body>

  <div id="login">
    <h2>Bienvenido a POPEYES</h2>
    <h1>Iniciar Sesión para realizar tu reservación</h1>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button onclick="login()">Entrar</button>
  </div>

  <div id="main" style="display:none">

    <div>
      <button onclick="logout()">Cerrar Sesión</button>
    </div>

    <h1>Página Principal</h1>

    <div id="reservation">

      <h1>Hacer una Reserva</h1>

      <input type="number" id="client-id" placeholder="Número de cédula">
      <input type="number" id="invites" placeholder="Invitados">
      <input type="datetime-local" id="datetime">

      <button onclick="makeReservation()">Reservar</button>

      <div id="reservation-message"></div>

      <h2>Mis Reservas</h2>

      <div id="my-reservations"></div>

    </div>

  </div>

  <script>

    // Almacenamiento en memoria temporal
    const reservations = [];

    // usuarios
    const users = [
      {
        username: 'roberto',
        password: '1234'
      },
      {
        username: 'josue',
        password: '5678'
      }
    ];

    let clientName = '';

    const login = function () {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;

      // Validacion de datos
      const user = users.find(u => u.username === username && u.password === password);

      if (user) {
        showMainPage();
        clientName = username;
        clearFields(['username', 'password']);
      } else {
        alert('Datos de acceso inválidos');
      }
    };

    const makeReservation = function () {
      const clientId = document.getElementById('client-id').value;
      const invites = document.getElementById('invites').value;
      const datetime = document.getElementById('datetime').value;
      const reservationDate = new Date(datetime).toLocaleString();
      if (reservations.some(function (r) {
        const date = new Date(r.datetime).toLocaleString();
        const diffTime = Math.abs(new Date(date) - new Date(reservationDate));
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        return date === reservationDate && diffDays <= 1;
      })) {
        showMessage('Ya existe una reservación para ese día o el anterior', 'error');
        return;
      }

      if (reservations.some(function (r) {
        const date = new Date(r.datetime).toLocaleString();
        return date === reservationDate;
      })) {
        showMessage('Ya existe una reservación para ese día', 'error');
        return;
      }

      if (invites > 300) {
        showMessage('Máximo 300 invitados', 'error');
        return;
      }

      const reservation = {
        clientName,
        clientId,
        invites,
        datetime: reservationDate
      };

      reservations.push(reservation);

      showMyReservations();
      clearFields(['client-id', 'invites', 'datetime']);
      showMessage('Reserva exitosa', 'success');
    };

    const showMainPage = function () {
      document.getElementById("login").style.display = "none";
      document.getElementById("main").style.display = "block";
    };

    const logout = function () {
      document.getElementById("main").style.display = "none";
      document.getElementById("login").style.display = "block";
    };

    const showMyReservations = function () {
      const container = document.getElementById('my-reservations');

      container.innerHTML = '';

      reservations.forEach(function (r) {
        container.innerHTML += `
          <div>
            <b>Cliente:</b> ${r.clientName} <br>
            <b>Cédula:</b> ${r.clientId} <br>  
            <b>Invitados:</b> ${r.invites} <br>
            <b>Fecha/hora:</b> ${r.datetime}
          </div>
        `;
      });
    };

    const clearFields = function (fieldIds) {
      fieldIds.forEach(function (id) {
        document.getElementById(id).value = '';
      });
    };

    const showMessage = function (message, type) {
      const messageContainer = document.getElementById('reservation-message');
      messageContainer.textContent = message;
      messageContainer.className = type;
      messageContainer.style.display = 'block';

      setTimeout(function () {
        messageContainer.style.display = 'none';
      }, 3000);
    };

  </script>

</body>

</html>
